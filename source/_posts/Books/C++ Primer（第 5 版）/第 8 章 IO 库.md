---
title: 第 8 章 IO 库
categories:
- Book
- C++ Primer （第 5 版）
---
# 8.1 IO 类

- 条件状态（其类型为 `strm::iostate`）（这个类型应当当作位的集合使用）：
  
  |      标志       |               含义               |
  | :-------------: | :------------------------------: |
  | `strm::badbit`  |             流已崩溃             |
  | `strm::failbit` |        一个 IO 操作失败了        |
  | `strm::eofbit`  |         流到达了文件结束         |
  | `strm::goodbit` | 流未处于错误状态。这个值保证为 0 |

- `std::endl` 输出换行，然后刷新缓冲区
- `std::flush` 直接刷新缓冲区
- `std::ends` 输出一个空字符然后刷新缓冲区
- 以下情况默认刷新缓冲区：
  - `main` 函数的 `return` 操作的一部分。
  - 缓冲区满时，刷新缓冲后才能继续写入缓冲区。
  - 操作符（例如 `std::endl`）。
  - `std::unitbuf` 操纵符。这个操纵符设置后流会自动刷新（`std::nounitbuf` 反之会设置回默认的管理方式）。
  - 一个输出流关联到另一个流，读写被关联的流时，关联到的流的缓冲区会刷新（例如交互式系统应该把所有输出在读操作之前打印）。
  - `tie` 函数
    - 无参数：返回当前流关联的流（可能为空）的指针。
    - *ostream 参数：关联到传入的流。
  - 一个流同一时刻最多关联一个 `ostream`，多个流可以同时关联到同一个 `ostream`。

# 8.2 文件输入输出

- `open` 失败会将 `failbit` 置位。当之前打开的文件未关闭也会失败。
- `is_open` 函数可以判断是否打开文件。
- 文件模式（当作位的集合使用）
  
  |   模式   |           含义           |          限制          |
  | :------: | :----------------------: | :--------------------: |
  |   `in`   |            读            | `ifstream` / `fstream` |
  |  `out`   |            写            | `ofstream` / `fstream` |
  |  `app`   |     写操作定位到末尾     |  `trunc` 不能同时设定  |
  |  `ate`   | 打开文件后立即定位到末尾 |                        |
  | `trunc`  |         截断文件         |   `out` 必须也被设定   |
  | `binary` |      二进制方式 IO       |                        |

  `out` 模式下文件默认会被截断，除非同时设定 `app`（append），或者 `in`（同时读写）。

# 8.3 string 流